<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚³ã‚¸ãƒãƒ‰!! - å‚åŠ ãƒã‚§ãƒƒã‚¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>

<body>

<h1 class="title">ã‚³ã‚¸ãƒãƒ‰!!</h1>

<div class="top-nav">
  <a href="players.html">åç°¿ç®¡ç†</a>
  <a class="active" href="attendance.html">å‚åŠ ãƒã‚§ãƒƒã‚¯</a>
  <a href="index.html">è©¦åˆä½œæˆ</a>
</div>

<div class="panel">
  <h2>ä»Šæ—¥ã®å‚åŠ è€…</h2>
  <p class="muted">â€» ä»Šæ—¥æ¥ã¦ã„ã‚‹äººã«ãƒã‚§ãƒƒã‚¯ã—ã¦ã­</p>

  <ul id="activeList" style="list-style:none; padding:0; margin:0;"></ul>

  <div style="display:flex; gap:10px; margin-top:10px;">
    <button class="btn secondary" onclick="checkAll()">å…¨å“¡ON</button>
    <button class="btn danger" onclick="uncheckAll()">å…¨å“¡OFF</button>
  </div>

  <button class="btn primary" style="margin-top:12px;" onclick="saveActivePlayers()">
    å‚åŠ è€…ã‚’ä¿å­˜ â†’ è©¦åˆä½œæˆã¸
  </button>
</div>

<script src="common.js"></script>

<script>
/* =========================
   åˆæœŸè¡¨ç¤º
========================= */
window.onload = () => {
  loadAttendance();
};

/* =========================
   åç°¿ â†’ å‚åŠ ãƒã‚§ãƒƒã‚¯è¡¨ç¤º
========================= */
function loadAttendance() {
  const list = document.getElementById("activeList");
  list.innerHTML = "";

  const allPlayers = JSON.parse(localStorage.getItem("allPlayers") || "[]");
  const active = JSON.parse(localStorage.getItem("activePlayers") || "[]");

  if (allPlayers.length === 0) {
    list.innerHTML = `<li class="muted">åç°¿ãŒã¾ã ã ã‚ˆï¼å…ˆã«ç™»éŒ²ã—ã¦ã­</li>`;
    return;
  }

  allPlayers.forEach(name => {
    const checked = active.includes(name) ? "checked" : "";

    const li = document.createElement("li");
    li.style.marginBottom = "10px";

    li.innerHTML = `
      <div class="match-card">
        <label style="display:flex; align-items:center; gap:12px;">
          <input type="checkbox" class="chk" data-name="${name}" ${checked}>
          <div class="team team-a">${name}</div>
        </label>
      </div>
    `;

    list.appendChild(li);
  });
}

/* =========================
   å…¨å“¡ON / OFF
========================= */
function checkAll() {
  document.querySelectorAll(".chk").forEach(cb => cb.checked = true);
}

function uncheckAll() {
  document.querySelectorAll(".chk").forEach(cb => cb.checked = false);
}

/* =========================
   ä¿å­˜ â†’ è©¦åˆä½œæˆ
========================= */
function saveActivePlayers() {
  const checked = [];
  document.querySelectorAll(".chk").forEach(cb => {
    if (cb.checked) checked.push(cb.dataset.name);
  });

  if (checked.length < 4) {
    alert("4äººä»¥ä¸Šé¸ã‚“ã§ã­ğŸ’¦");
    return;
  }

  localStorage.setItem("activePlayers", JSON.stringify(checked));
  alert("ä¿å­˜ã—ãŸã‚ˆï¼è©¦åˆä½œæˆã¸è¡Œã“ğŸ’–");
  location.href = "index.html";
}
</script>

</body>
</html>
