<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>参加者チェック - コジバド!!</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">

<style>
body {
  font-family: "Hiragino Maru Gothic ProN", "Rounded Mplus 1c", sans-serif;
  background: #fff9fe;
  padding: 20px;
}

h2 {
  text-align: center;
  font-size: 32px;
  color: #ff66b3;
  margin-bottom: 20px;
}

.list-item {
  background: #ffe6f3;
  padding: 12px;
  border-radius: 12px;
  margin-bottom: 10px;
  border: 2px solid #ffb3d9;
  font-size: 18px;
}

.list-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.join-select {
  margin-left: 20px;
  padding: 6px;
  border-radius: 8px;
  border: 1px solid #ffb3d9;
  background: #fff;
}

button {
  width: 100%;
  padding: 15px;
  font-size: 20px;
  border-radius: 15px;
  border: none;
  font-weight: bold;
  margin-top: 10px;
  cursor: pointer;
}

.green { background: #8ee38e; color: white; }
.red   { background: #ff6675; color: white; }
.pink  { background: #ff99cc; color: white; }
</style>
</head>

<body>

<h2>参加者チェック</h2>

<button class="pink" onclick="location.href='players.html'">
  名前管理へ戻る
</button>

<p style="text-align:center; margin-top:10px;">
  今日来ている人にチェックを入れてください
</p>

<ul id="activeList" style="padding-left:0; list-style:none;"></ul>

<button class="green" onclick="checkAll()">全員 ON</button>
<button class="red"   onclick="uncheckAll()">全員 OFF</button>

<button class="green" onclick="saveActivePlayers()">参加者を保存 → 試合作成へ</button>

<script src="common.js"></script>

<script>
window.onload = () => {
  loadPlayersToAttendance();
};

/* 参加者リストを読み込む（途中参加つき） */
function loadPlayersToAttendance() {
  const list = document.getElementById("activeList");
  list.innerHTML = "";

  const players = JSON.parse(localStorage.getItem("allPlayers") || "[]");
  const joinData = JSON.parse(localStorage.getItem("joinRoundData") || "{}");

  players.forEach(name => {
    const checked = true; // 初期はONにしない（外す?）
    const joinRound = joinData[name] || 1;

    const li = document.createElement("li");
    li.className = "list-item";

    li.innerHTML = `
      <div class="list-row">
        <label>
          <input type="checkbox" class="chk" data-name="${name}">
          <span>${name}</span>
        </label>

        <select class="join-select" data-name="${name}">
          <option value="1">1試合目から</option>
          <option value="2">2試合目から</option>
          <option value="3">3試合目から</option>
          <option value="4">4試合目から</option>
          <option value="5">5試合目から</option>
          <option value="6">6試合目から</option>
          <option value="7">7試合目から</option>
          <option value="8">8試合目から</option>
          <option value="9">9試合目から</option>
          <option value="10">10試合目から</option>
          <option value="11">11試合目から</option>
          <option value="12">12試合目から</option>
        </select>
      </div>
    `;

    // 途中参加ラウンドを反映
    li.querySelector(".join-select").value = joinRound;

    list.appendChild(li);
  });
}

function checkAll() {
  document.querySelectorAll(".chk").forEach(cb => cb.checked = true);
}

function uncheckAll() {
  document.querySelectorAll(".chk").forEach(cb => cb.checked = false);
}

/* 参加者保存 */
function saveActivePlayers() {
  const chks = document.querySelectorAll(".chk");
  const selects = document.querySelectorAll(".join-select");

  let active = [];
  let joinRoundData = {};

  chks.forEach(cb => {
    const name = cb.dataset.name;
    if (cb.checked) active.push(name);
  });

  selects.forEach(sel => {
    const name = sel.dataset.name;
    joinRoundData[name] = Number(sel.value);
  });

  if (active.length < 4) {
    alert("参加者は最低4人必要です！");
    return;
  }

  localStorage.setItem("activePlayers", JSON.stringify(active));
  localStorage.setItem("joinRoundData", JSON.stringify(joinRoundData));

  alert("参加者を保存しました！");
  location.href = "index.html";
}
</script>

</body>
</html>
